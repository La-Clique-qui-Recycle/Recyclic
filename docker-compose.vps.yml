# docker-compose.vps.yml
# Configuration de surcharge pour d√©ploiement sur VPS avec Traefik

version: "3.8"

networks:
  traefik-public:
    external: true

services:
  api:
    environment:
      - ALLOWED_HOSTS=recyclic.jarvos.eu,localhost,127.0.0.1
      - CORS_ALLOW_ORIGINS=https://recyclic.jarvos.eu
      - BACKEND_CORS_ORIGINS=https://recyclic.jarvos.eu
      - FRONTEND_URL=https://recyclic.jarvos.eu
    networks:
      - traefik-public
      - recyclic-network
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.recyclic-api.rule=Host(`recyclic.jarvos.eu`) && PathPrefix(`/api`)"
      - "traefik.http.routers.recyclic-api.entrypoints=web,websecure"
      - "traefik.http.routers.recyclic-api.tls=true"
      - "traefik.http.routers.recyclic-api.tls.certresolver=myresolver"
      - "traefik.http.services.recyclic-api.loadbalancer.server.port=8000"

  frontend:
    build:
      context: ./frontend
      args:
        REACT_APP_API_URL: "https://recyclic.jarvos.eu/api"
    environment:
      - HOST=0.0.0.0
      - DANGEROUSLY_DISABLE_HOST_CHECK=true
    networks:
      - traefik-public
      - recyclic-network
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.recyclic-front.rule=Host(`recyclic.jarvos.eu`)"
      - "traefik.http.routers.recyclic-front.entrypoints=web,websecure"
      - "traefik.http.routers.recyclic-front.tls=true"
      - "traefik.http.routers.recyclic-front.tls.certresolver=myresolver"
      - "traefik.http.services.recyclic-front.loadbalancer.server.port=80"
