# Story 1.3: Ascenseur Fonctionnel Tickets Vente

## Status
Ready for Development

## Story
**As a** caisse operator,
**I want** a scrollable sales ticket list with fixed bottom summary so that I can review all items while keeping total and finalize button always visible.

## Acceptance Criteria
1.3.1: Sales ticket list displays scrollable area when content exceeds viewport
1.3.2: Bottom summary block (total items, total price, finalize button) remains fixed and visible
1.3.3: Scrolling behavior is smooth and responsive
1.3.4: Visual indicators show when content is scrollable

## Tasks / Subtasks

- [ ] **Task 1: Créer le composant TicketScroller** (AC: 1.3.1, 1.3.2, 1.3.3, 1.3.4)
  - [ ] Créer `frontend/src/components/tickets/TicketScroller.tsx`
  - [ ] Implémenter layout avec zone scrollable et summary fixe en bas
  - [ ] Utiliser CSS flexbox/grid pour séparation des zones
  - [ ] Ajouter indicateurs visuels de scrollabilité (scrollbar stylisée)

- [ ] **Task 2: Créer le service ScrollPositionManager** (AC: 1.3.3, 1.3.4)
  - [ ] Créer `frontend/src/utils/scrollManager.ts`
  - [ ] Implémenter logique de détection contenu scrollable
  - [ ] Gérer événements scroll smooth et responsive
  - [ ] Optimiser performance avec throttling/debouncing

- [ ] **Task 3: Créer le composant TicketHighlighter** (AC: 1.3.1, 1.3.3)
  - [ ] Créer `frontend/src/components/tickets/TicketHighlighter.tsx`
  - [ ] Implémenter feedback visuel lors du scroll (highlight éléments)
  - [ ] Gérer focus et accessibilité lors navigation scroll
  - [ ] Intégrer avec ScrollPositionManager

- [ ] **Task 4: Étendre le store pour la gestion du scroll** (AC: 1.3.1, 1.3.2, 1.3.3)
  - [ ] Étendre store tickets existant avec états scroll
  - [ ] Ajouter actions: setScrollPosition, updateScrollableState
  - [ ] Gérer synchronisation état scroll avec composants

- [ ] **Task 5: Intégrer TicketScroller dans le workflow caisse** (AC: 1.3.1, 1.3.2)
  - [ ] Wrapper autour de la liste tickets existante
  - [ ] Préserver logique affichage tickets pour petits contenus
  - [ ] Positionner summary fixe (total, bouton finaliser) en bas

- [ ] **Task 6: Optimisations performance et accessibilité** (AC: 1.3.3, 1.3.4)
  - [ ] Implémenter virtual scrolling si nécessaire pour gros volumes
  - [ ] Optimiser rendu avec React.memo et useMemo
  - [ ] Ajouter support clavier pour navigation scroll
  - [ ] Respecter standards WCAG pour indicateurs visuels

- [ ] **Task 7: Tests unitaires et d'intégration** (AC: Tous)
  - [ ] Tests unitaires TicketScroller: rendu layout, séparation zones
  - [ ] Tests ScrollPositionManager: détection scroll, événements smooth
  - [ ] Tests intégration: comportement scroll avec contenu variable
  - [ ] Tests performance: impact <5% dégradation, virtual scrolling si besoin

## Dev Notes

### Références Architecturales Clés
1. **COMMENCER PAR**: `docs/v1.3.0-active/architecture/index.md` - Navigation complète de l'architecture (19 fichiers total)
2. **Architecture Composants**: `docs/v1.3.0-active/architecture/6-architecture-des-composants.md` - Spécifications TicketScroller, ScrollPositionManager, TicketHighlighter
3. **Structure Projet**: `docs/v1.3.0-active/architecture/8-intgration-dans-larborescence-source.md` - Chemins composants tickets et utils
4. **Standards Codage**: `docs/v1.3.0-active/architecture/10-standards-de-codage-et-conventions.md` - Patterns composants React, accessibilité WCAG 2.1 AA
5. **Stratégie de Test**: `docs/v1.3.0-active/architecture/11-stratgie-de-test.md` - Tests performance, accessibilité
6. **Infrastructure**: `docs/v1.3.0-active/architecture/9-infrastructure-et-dploiement.md` - Constraints performance scroll

### Previous Story Insights
**Story 1.1** - Boutons prix prédéfinis: Patterns composants Mantine validés, intégration stores Zustand
**Story 1.2** - Gestion catégories: Extensions stores existants, patterns composants catégories établis

### Data Models
**Aucun nouveau modèle requis** [Source: architecture/5-modles-de-donnes-et-schma-changes.md]
- Utilise modèles tickets existants (Transaction, TransactionItem)
- Extension CashSession pour métriques scroll si nécessaire (optionnel)

### API Specifications
**Aucune modification API requise** [Source: architecture/7-design-et-intgration-api.md]
- Utilise endpoints existants pour récupération tickets
- Fonctionnalité purement frontend/UI

### Component Specifications
**TicketScroller** [Source: architecture/6-architecture-des-composants.md]:
- Wrapper React autour liste tickets existante
- Layout flexbox: zone scrollable + summary fixe bottom
- Hauteur dynamique selon contenu et viewport
- Indicateurs visuels scroll (styled scrollbars)

**ScrollPositionManager** [Source: architecture/6-architecture-des-composants.md]:
- Service utilitaire pour gestion événements scroll
- Détection contenu dépassant viewport
- Smooth scrolling avec requestAnimationFrame
- Throttling événements pour performance

**TicketHighlighter** [Source: architecture/6-architecture-des-composants.md]:
- Feedback visuel pendant scroll (highlight éléments actifs)
- Gestion focus accessibilité
- Intégration avec ScrollPositionManager

### File Locations
**Frontend (React/TypeScript)** [Source: architecture/8-intgration-dans-larborescence-source.md]:
- `frontend/src/components/tickets/TicketScroller.tsx` - Composant principal
- `frontend/src/components/tickets/TicketHighlighter.tsx` - Feedback visuel
- `frontend/src/utils/scrollManager.ts` - Logique scroll utilitaire
- `frontend/src/stores/ticketStore.ts` - Extension store existant (état scroll)

### Testing Requirements
**Tests Critiques** [Source: architecture/11-stratgie-de-test.md]:
- Tests layout: séparation zones scrollable/fixe
- Tests scroll: comportement smooth, indicateurs visuels
- Tests performance: rendu avec gros volumes de données
- Tests accessibilité: navigation clavier, lecteurs écran

**Métriques Performance** [Source: architecture/11-stratgie-de-test.md]:
- Impact performance <5% (même seuil que autres stories)
- Tests avec 100+ items tickets
- Validation smooth scrolling sur mobile/tablet

### Technical Constraints
**Performance Critique** [Source: architecture/9-infrastructure-et-dploiement.md]:
- Impact rendu <5% dégradation existante
- Virtual scrolling automatique pour >50 items
- Optimisations React (memo, lazy) pour fluidity

**Responsive Design** [Source: architecture/8-intgration-dans-larborescence-source.md]:
- Layout adaptatif mobile/tablet/desktop
- Touch scrolling optimisé mobile
- Indicateurs scroll adaptés taille écran

**Accessibilité** [Source: architecture/10-standards-de-codage-et-conventions.md]:
- Conformité WCAG 2.1 AA obligatoire
- Navigation clavier complète
- Indicateurs scroll non-textuels accompagnés texte

## Testing

### Testing
**Stratégie de Test** [Source: architecture/11-stratgie-de-test.md]:
- Tests unitaires: composants TicketScroller et utilitaires scroll
- Tests intégration: comportement complet avec données réelles
- Tests performance: métriques rendu avec volumes variables
- Tests accessibilité: conformité WCAG avec outils automatisés

**Scénarios de Test Critiques**:
- AC 1.3.1: Zone scrollable apparaît quand contenu dépasse viewport
- AC 1.3.2: Summary reste fixe et visible pendant scroll
- AC 1.3.3: Scroll smooth et responsive sur tous devices
- AC 1.3.4: Indicateurs visuels clairs de scrollabilité

**Outils de Test Spécialisés**:
- Lighthouse pour performance scroll
- axe-core pour accessibilité
- Tests manuels cross-browser (Chrome, Safari, Firefox)

### Testing Instructions
**Outils de Test :**
- **DevTools Browser** (F12) pour inspecter les performances de scroll et l'état des composants
- **Comptes de test :**
  - Utilisateur: `usertest1` / `Test1234!`
  - URLs: Frontend `http://localhost:4444`

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-01-17 | 1.0 | Création initiale de la story | Bob (Scrum Master) |

## Dev Agent Record

### Agent Model Used

### Debug Log References

### Completion Notes List

### File List

## QA Results
